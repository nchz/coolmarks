{% extends "base.html" %}

{% block html_head %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<script>

  function findCheckedRows() {
    var result = [];
    $("table > tbody input[type='checkbox']:checked").each((i, elem) => {
      result.push(elem.id);
    });
    return result;
  }

  $(document).ready(function () {
    $("#delete-form").submit(function () {
      var checkedRows = findCheckedRows();
      $("<input />")
        .attr("type", "hidden")
        .attr("name", "link_ids")
        .attr("value", checkedRows.join(","))
        .appendTo(this);
      return true;
    });
  });

  $(document).ready(function () {
    $("#select-all").click(function () {
      $("table > tbody input[type='checkbox']:not(:checked)").click();
    })
  });

  $(document).ready(function () {
    $("#select-none").click(function () {
      $("table > tbody input[type='checkbox']:checked").click();
    })
  });

  $(document).ready(function () {
    console.log("aloha!");
  });

</script>

{% endblock %}

{% block body_main %}

<div class="d-flex m-2">

  <div style="width: 150;">
    <h6 class="mx-2 mt-1 mb-0">Select</h6>
    <div class="d-flex">
      <button id="select-all" class="col m-1 btn btn-secondary">All</button>
      <button id="select-none" class="col m-1 btn btn-secondary">None</button>
    </div>
  </div>

  <div class="vr m-2"></div>

  <div class="col">
    <h6 class="mx-2 mt-1 mb-0">Add Link</h6>
    <form action="{% url 'links:list' %}" method="POST" class="d-flex">
      {% csrf_token %}
      <button type="submit" class="m-1 btn btn-success">+</button>
      {% with link_list|first as first %}
      <input type="text" name="_tags_string" placeholder="tags; separated; by ;" value="{{ first.tags_string }}"
        class="col m-1 form-control">
      {% endwith %}
      <input required type="url" name="location" placeholder="http://example.com" class="w-75 m-1 form-control">
    </form>
  </div>

</div>

<div style="padding: 20px 20px 0px 20px;">
  <form id="delete-form" action="{% url 'links:delete' %}" method="POST"
    style="display: flex; justify-content: space-between;">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger" style="padding: 5px 20px;">Delete</button>
  </form>
</div>

<table id="links-table" class="table table-hover">
  <thead>
    <tr>
      <th></th>
      <th>Date added</th>
      <th>Title</th>
      <th>Domain</th>
      <th>Tags</th>
    </tr>
  </thead>
  <tbody>
    {% for link in link_list %}
    <tr>
      <td style="width: 0;">
        <input id="{{ link.id }}" type="checkbox"
          onchange="this.parentElement.parentElement.classList.toggle('table-active')">
      </td>
      <td onclick="$('input#{{ link.id }}').click()">
        {{ link.dt | slice:":19" }}
      </td>
      <td><a href="{{ link.location }}" target="_blank">{{ link.title }}</a></td>
      <td>{{ link.domain }}</td>
      <td>
        {% for tag in link.tags.all %}
        <span class="my-1 badge rounded-pill bg-primary">
          {{ tag.name }}<span style="font-size: 0;">;</span>
        </span>
        {% endfor %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}